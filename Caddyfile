{
    admin localhost:2019
    auto_https off 
}

:8000 {
    log {
        output stdout
        format json
    }

    # 1. Route for admin.nepdora.com (including WebSockets)
    @admin_host host admin.nepdora.com
    handle @admin_host {
        # This single line handles all HTTP and WebSocket traffic to localhost:8001
        reverse_proxy localhost:8001 {
             # CRITICAL: Pass WebSocket headers for Daphne Channels
             header_up Upgrade {header.Upgrade}
             header_up Connection {header.Connection}
             # Pass original host and protocol headers
             header_up Host {http.request.host}
             header_up X-Forwarded-For {remote_ip}
             header_up X-Forwarded-Proto {http.request.scheme}
        }
    }

    # 2. Fallback Route: This 'handle' block catches all requests that did not match 
    #    the 'admin_host' route above.
    # It acts as your custom 404 page.
    handle {
        respond "Sales CRM Gateway: Route not found for {host}" 404
    }
}